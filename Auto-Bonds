local plr = game.Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()

local hum = char:WaitForChild("Humanoid")
if not hum or hum.Health <= 0 then return end

local root = char:WaitForChild("HumanoidRootPart")
local start = root.Position
local endpos = Vector3.new(-424.443603515625, 29.518972396850586, -49040.59375)

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local RemotePromise = ReplicatedStorage:WaitForChild("Shared"):WaitForChild("Network"):WaitForChild("RemotePromise"):WaitForChild("Remotes")

local function collectBond(model)
    RemotePromise:WaitForChild("C_ActivateObject"):FireServer(model)
end

local function searchItem(itemname)
    local newpos = start
    while not workspace.RuntimeItems:FindFirstChild(itemname) do
        root.CFrame = CFrame.new(newpos, endpos) * CFrame.new(0, 0, -100)
        newpos = root.Position
        task.wait(0.01)
    end
end

local function getNearestItem(ItemName)
    local item = nil
    local lastDist = math.huge
    for _, v in pairs(workspace.RuntimeItems:GetChildren()) do
        if v.Name == ItemName and v:IsA("Model") and v:FindFirstChildWhichIsA("BasePart") then
            local dist = (v:GetPrimaryPartCFrame().Position - root.Position).Magnitude
            if dist < lastDist then
                item = v
                lastDist = dist
            end
        end
    end
    return item
end

local function handleChair()
    searchItem("Chair")
    local chair = workspace.RuntimeItems:FindFirstChild("Chair")
    if not chair then return end

    if not chair.PrimaryPart then
        chair.PrimaryPart = chair:FindFirstChild("PrimaryPart") or chair:FindFirstChildWhichIsA("BasePart")
    end

    local seat = chair:FindFirstChildWhichIsA("Seat")
    local tik = 0

    while not hum.Sit and tik < 5 do
        root.CFrame = CFrame.new(chair.PrimaryPart.Position)
        if seat then seat:Sit(hum) end
        tik += 0.01
        task.wait(0.01)
    end

    if not char:FindFirstChild("Sack") and plr.Backpack:FindFirstChild("Sack") then
        hum:EquipTool(plr.Backpack.Sack)
    end

    Remotes:WaitForChild("StoreItem"):FireServer(chair)
    root.CFrame = CFrame.new(start)
end

local function autoBond()
    local success, msg = pcall(function()
        searchItem("Bond")
        local bond = getNearestItem("Bond")
        if bond then
            if not bond.PrimaryPart then
                bond.PrimaryPart = bond:FindFirstChildWhichIsA("BasePart")
            end

            local distance = (bond.PrimaryPart.Position - root.Position).Magnitude
            if distance > 5 then
                root.CFrame = CFrame.new(bond.PrimaryPart.Position)
                Remotes:WaitForChild("DropItem"):FireServer()

                local chair = getNearestItem("Chair")
                if chair and chair:FindFirstChildWhichIsA("Seat") then
                    chair:FindFirstChildWhichIsA("Seat"):Sit(hum)
                end
            end

            task.wait(0.25)
            collectBond(bond)
            Remotes:WaitForChild("StoreItem"):FireServer(bond)
        end
    end)

    if success then
        print("Bond collected successfully.")
        autoBond()
    else
        warn("Error during autoBond:", msg)
    end
end

handleChair()
autoBond()
